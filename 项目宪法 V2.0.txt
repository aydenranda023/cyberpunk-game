PROJECT NEURAL LINK: MASTER CONSTITUTION V2.0
项目代号： Neural Link (多元宇宙编年史)
版本： Architecture V2.0 (The Multiverse Update)
核心转变： 从“线性文本接龙”全面升级为“基于 DAG 树状数据结构的多元宇宙状态机”。

1. 愿景与核心哲学 (Vision & Philosophy)
1.1 终极形态 (The North Star)
叙事状态机： AI 不再仅仅是“续写文本的打字机”，而是掌控全局的“地牢主宰 (DM)”。它拥有独立思考（思维链）的能力，负责更新世界的底层状态（紧张度、玩家血量、全局摘要）。

非线性多元宇宙： 故事不再是一条直线。玩家的行为会在时间线上创造“分叉（平行宇宙）”；玩家的技能可以撕裂空间，进行“维度跳跃（跨宇宙传送）”。

空间可视化（未来蓝图）： 所有的历史轨迹将在前端通过 Three.js 渲染为一棵“3D 宇宙树”。玩家可以上帝视角观测时间线、回溯节点、或者连接不同的宇宙分支。

1.2 开发模式原则 (Development Principles)
Local First (本地先行)： 第一阶段彻底剥离 Vercel 和复杂云数据库，全部后端逻辑在本地 Node.js (Express) 运行，数据暂存在本地内存/JSON 文件中。跑通核心逻辑后再上云。

Model Shift： 核心大模型从 Gemini 迁移至 DeepSeek，以获得更强的逻辑推理能力和更稳定的 JSON 结构化输出。

2. 核心架构：有向无环图数据模型 (The DAG Architecture)
废弃原有的 history: ["...", "..."] 数组模型。整个游戏数据库是一张由“节点 (Node)”组成的巨大网络。

2.1 节点数据结构 (Node Schema)
每一个剧情回合（Turn），都会在系统中生成一个独立的 Node 对象：

JSON
{
  "node_id": "uuid_或者_turn_编号",
  "parent_id": "上一个节点的ID", // 【灵魂字段】决定了时间线的连贯与分叉
  "universe_tag": "Cyberpunk | Medieval | Wasteland", // 宇宙维度标签
  "state_snapshot": {
    "global_summary": "精简的150字前情提要（AI更新）",
    "tension_level": 80, // 紧张度 0-100（决定叙事节奏）
    "current_objective": "逃离荒坂塔",
    "key_facts": ["获得了神秘的蓝鸟芯片", "腿部中弹"]
  },
  "narrative_text": "本回合给玩家展示的具体剧情描述...",
  "player_status": {
    "hp": 20,
    "inventory": ["高斯步枪"]
  }
}
2.2 上下文溯源机制 (Context Retrieval)
绝对禁止全局拼接。 当玩家提交动作时，后端通过当前玩家所在的 current_node_id，沿着 parent_id 向上回溯（例如提取最近 3 个祖先节点），动态组装出绝对纯净、无污染的单线上下文，发送给 AI。

3. AI 交互协议 (The AI Contract)
每次调用 DeepSeek，必须强制其按照“思维链 + 状态更新 + 文本生成”的结构返回 JSON。

AI 返回结构规范：

JSON
{
  "director_notes": "DM的思考过程：玩家跳跃到了废土，环境辐射极高，我需要描写他的窒息感，并把紧张度拉满...",
  "state_update": {
    "global_summary": "玩家利用传送门逃离了赛博宇宙，意外降落在一片辐射废土中...",
    "tension_change": +20,
    "new_objective": "寻找防毒面具和避难所",
    "new_facts": ["废土宇宙存在极高辐射"]
  },
  "views": {
    "narrative": "你跌出传送门，摔在干裂的赤色大地上。肺部像吸入了碎玻璃般刺痛..."
  }
}
4. 多元宇宙的核心玩法逻辑 (Gameplay Mechanics)
基于 parent_id 的三种基础路线：

顺流直下 (Linear Progression)： 正常游玩。新生成节点的 parent_id 指向当前节点。

时间分叉 (Timeline Branching)： 玩家利用观测仪回到过去的节点 X 并做出不同选择。新生成节点的 parent_id 依然指向 X，形成平行世界分支。

维度跳跃 (Dimension Jump / Nexus Event)： 玩家强制开启传送门。后端需提取起点宇宙（玩家状态）和终点宇宙（环境状态），缝合成特殊 Prompt。新节点在逻辑上延续起点，但 universe_tag 和环境设定瞬间切换。

5. 阶段性实施路线图 (Phased Roadmap)
Phase 1: Local MVP (本地单线状态机)

搭建本地 Express 服务，使用内存数组模拟数据库。

接入 DeepSeek API。

跑通“带状态机的 Prompt 协议”，验证 AI 能否根据 state_update 维持长线记忆和连贯性。

Phase 2: The DAG Multiverse (图谱与跳跃逻辑)

实装 parent_id 树状数据结构。

实现“根据游标回溯上下文”的算法。

实装“跨维度跳跃”的接口与特殊状态合并逻辑。

Phase 3: Visuals & UI (前端 3D 宇宙树)

利用 Three.js 将后端的 Node 数据渲染为 3D 星图。

实现玩家点击节点进行时间回溯或维度观察的交互。

Phase 4: Cloud & RAG (上云与向量回忆)

将后端部署至 Zeabur 或阿里云等生产环境。

引入向量数据库，给不同宇宙的节点打标签，实现跨维度的“长线伏笔回忆”。