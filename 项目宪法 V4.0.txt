PROJECT NEURAL LINK: MASTER CONSTITUTION V4.0
项目代号： Neural Link (高维叙事合成器 / The Narrative Synthesizer)
版本： Architecture V4.0 (The Conductor's Edition / 指挥家版)
核心转变： 从“多视角小说”进化为“基于实体轨道（Event Lines）的参数化叙事混音台”。视觉风格从“赛博废土”全面转向“极致整洁、高科技、参数化结构”的秩序美学。

1. 愿景与核心哲学 (Vision & Philosophy)
1.1 终极形态 (The North Star)
交响乐编排引擎： 游戏世界不再由单纯的时间线构成，而是由无数条独立的“事件线”（人物、地点、物品、事件）组成。它们就像不同的乐器轨道。

造物主视角： 玩家扮演“指挥家”，不再做预设的 A/B 选择。交互方式变为：在素材库中挑选不同维度的状态元素，将它们拖拽进“合成釜”中，让 AI 推演出这些元素碰撞后的化学反应。

高维秩序美学： 放弃随意、杂乱的点云风格。界面必须极其克制、整洁、极简。3D 空间中的数据结构必须呈现出严谨的建筑感和拓扑逻辑，宛如一张高科技的动态三维乐谱。

2. 核心架构：多轨交织的 DAG 模型 (Multi-Track DAG)
底层数据结构从“单线树状”升级为“多父节点（Multi-Parent）网络”。

2.1 轨道的独立与交织 (Tracks & Convergence)
事件线 (Event Line)： 每一个实体（如：杀手艾莉亚、荒坂大厦、EMP手雷）都有一条独立记录其状态变迁的历史轨道。

合成节点 (Convergence Node)： 当玩家将多个实体拖入合成釜生成剧情时，系统会生成一个拥有多个 parent_id 的交汇节点。

2.2 状态刷新闭环 (The State-Update Loop)
【核心铁律】 合成节点生成后，不仅要输出本回合的剧情文本，必须立刻返回并更新所有参与该节点的事件线的“最新状态”。

示例： 玩家合成【艾莉亚 (满血)】+【废土变异犬 (饥饿)】。AI 演算后，生成了一场惨烈的战斗剧情。系统必须立刻将艾莉亚的最新状态更新为【受伤/疲惫】，变异犬状态更新为【死亡】。供下一回合调用。

2.3 错位时空法则 (The Anomaly Protocol / 使用旧状态)
玩家被允许打破线性时间，强行拖拽某条事件线的**“历史旧节点”**参与当前合成。

机制约束： 当后端检测到传入的节点不是该事件线的 latest_node 时，必须在发给 AI 的 Prompt 中打上强警告标签：[时空异常警告：该元素提取自过去的时空状态]。

AI 裁决： 强制 AI 用高维叙事手法来“圆谎”。例如：通过角色之口讲述一段往事（“这把枪让我想起了当年...”）、触发一段闪回记忆、或者是发现了一段全息录像残影。

3. UI/UX 范式：参数化结构工作台 (Parametric UI)
界面设计追求极致的功能性与空间透视感，完全适配移动端“拖拽与点击”的直觉交互。

3.1 视觉风格约束
背景与材质： 纯粹的深空灰底色，辅以高透明度的磨砂玻璃面板（极简的白/浅灰冷光，舍弃高饱和霓虹色）。

UI 布局： 类似节点编程软件（如 Grasshopper）或高级混音台。抛弃所有文本输入框和常规选项按钮。

3.2 核心空间结构 (The 3D Score)
三维乐谱可视化： 3D 界面不再是杂乱生长的树，而是由多根平行的“轨道管线”组成。当发生“合成”时，这些管线在三维空间中优雅地弯曲、交汇于一个几何节点，随后再次分离。必须强调所有事件线之间的结构化纠缠关系。

3.3 移动端交互流 (The Mixing Workflow)
轨道抽屉 (Asset Pool)： 屏幕边缘可滑出的面板，罗列当前可用的“事件线卡片”（人物、地点、物品）。

合成釜 (The Crucible)： 屏幕核心区域的拖拽接收区。玩家将选中的卡片拖入其中。

推演触发： 选定元素后，点击极简的【合成 (Synthesize)】按钮，触发 3D 节点交汇动画与 AI 演算。

4. AI 协议：叙事指挥家大脑 (The Synthesizer Prompt)
DeepSeek 的角色从“剧情续写者”转变为“元素反应推演器”。

AI 返回 JSON 规范（必须包含反向更新）：

JSON
{
  "director_notes": "分析传入的 3 个元素：现在的地点、现在的人物、以及一件过去的物品。我将通过回忆的视角来缝合...",
  "narrative_text": "合成后的高品质剧情文本...",
  "event_lines_update": {
    "entity_arya_01": {"new_state": "陷入回忆的悲伤", "status": "active"},
    "entity_gun_02": {"new_state": "触发了旧日残影", "status": "consumed"}
  }
}
5. 深层潜意识网络：语义共鸣 (RAG Integration)
在无文本输入的架构下，RAG 不再用于“搜索”，而是用于在元素发生物理碰撞时，唤醒其**“历史与情感的羁绊”**。

5.1 组合触发的“时空回响” (Temporal Echoes)
玩家将多个实体拖入合成釜（如：【艾莉亚】+【生锈左轮】），后端自动将这些实体的组合描述转化为 Vector Query。

向量数据库检索包含这些实体 Metadata 的历史 Convergence Node，提取深层记忆。

提取出的历史文本作为 [时空回响] 模块注入 Prompt，要求 AI 将这段尘封的记忆无缝编织进当前的感官描写中。

5.2 RAG 的视觉预渲染 (Resonance Glow)
玩家在拖拽元素尚未点击合成时，前端后台进行轻量级 RAG 检索。3D 空间中相关的远古历史节点会提前亮起微弱的紫光，建立一条隐秘的连线，给予玩家极强的情绪期待与掌控感。

6. 阶段性实施路线图 (The Execution Roadmap)
【优先级铁律】从表层交互到核心逻辑，RAG 语义层作为最后一块拼图。

Phase 1: 混音台静态 UI 搭建 (Parametric Frontend)

使用 HTML/CSS 构建深空灰背景的磨砂玻璃 UI。

实现 Asset Pool (素材卡片) 到 Crucible (合成釜) 的丝滑拖拽交互交互。完全剔除输入框。

Phase 2: 多轨数据结构与状态闭环 (The Multi-Track Engine)

重新设计后端 JSON 数据库结构，支持 Event Lines 独立存储与 Multi-Parent Node (多父节点) 拓扑关系。

实装 AI 演算后的 event_lines_update 状态反向写回逻辑，以及旧状态检测 (Anomaly Protocol)。

Phase 3: 参数化三维可视化 (The Structured 3D Score)

引入 Three.js 构建平行的轨道系统。用极其克制的几何体和贝塞尔曲线，精确表现实体的交汇、分离与纠缠。

Phase 4: 语义共鸣引擎 (RAG & Temporal Echoes) 【终极阶段】

引入 Supabase pgvector（或本地向量库）。

实装带 Metadata 的节点向量化入库逻辑。

跑通组合元素生成 Query -> 提取历史回响 -> 注入 Prompt 的终极文学合成闭环。